<div align="center">
  <h1>Распределённый вычислитель
<br> арифметических выражений </h1>
</div>

## ℹ️ О проекте 
Проект - распределенная система для вычисления арифметических выражений, которая состоит из оркестратора и агента. Логика подразумевает обрабатывание сложных арифметических выражений, разбивая их на отдельные операции, которые могут выполняться параллельно.

Оркестратор — это HTTP-сервис, который позволяет вводить математические выражения. Сам оркестратор не решает выражения — вместо этого он преобразует заданные выражения.В этом случае «агент» выполняет часть решения.

Агент — демон, который обращается к оркестратору для получения задач. Задача — это выражение. Агент использует параллелизм для одновременного решения нескольких задач.

### Для начала
1. Установите Golang: [https://go.dev/dl/](https://go.dev/dl/).
2. Установите Git: [https://git-scm.com/downloads](https://git-scm.com/downloads).
3. Склонируйте проект с GitHub:
```bash
git clone https://github.com/Yukiro-Proseko/Main_P.git
```
4. Перейдите в директорию проекта


## Структура Проекта
+ ### cmd - точка входа
  + ### agent/main.go - запуск агента
  + ### orchestrator/main.go - запуск оркестратора
+ ### internal - логика сервисов
  + ### agent - пакет с логикой подсчета выражений
  + ### orchestrator - пакет с логикой подачи этих самых выражений
  + ### authoriz - пакет с логикой авторизации
+ ### pkg - вспомогательный пакет.
  + ### calc.go - парсинг выражения.
 
   ## Эндпоинты
| Эндпоинт | Допустимые методы | Описание |
| --- | --- | --- |
| /api/v1/calculate | *POST* | Получает POST-запрос c телом запроса в формате [JSON], содержащим выражение. |
| /api/v1/expressions | *GET* | Получает все выражения |
| /api/v1/expressions/{id} | *GET* | Получает выражение по его UUID |

## Коды ответов
* 200 - Выражение успешно получено / список выражений получен успешно
* 201 - Выражение принято для вычисления
* 400 - Неверный формат запроса
* 404 - Выражение не найдено
* 422 - Невалидные данные
* 405 - Неверный метод запроса
* 500 - Что-то пошло не так
 
## ▶️ Запуск
Запустите сервисы оркестратора и агента поочередно в разных терминалах.
```bash
go run ./cmd/orchestator
```
```bash
go run ./cmd/agent
```
Или одной командой
```bash
go run ./cmd/orchestator && go run ./cmd/agent
```
Сервис будет доступен по адресу http://localhost:8080/

Запуск на Unix-системах (Linux, macOS) с помощью Makefile
1. Убедитесь, что `make` установлен (обычно предустановлен):
- Если нет, установите:
  - Linux: `sudo apt install make` (Ubuntu/Debian) или `sudo yum install make` (CentOS).
  - macOS: `xcode-select --install`.

### Переменные  среды сервиса
*COMPUTING_POWER - количество горутин
TIME_ADDITION_MS - время выполнения операции сложения в миллисекундах  
TIME_SUBTRACTION_MS - время выполнения операции вычитания в миллисекундах  
TIME_MULTIPLICATIONS_MS - время выполнения операции умножения в миллисекундах  
TIME_DIVISIONS_MS - время выполнения операции деления в миллисекундах*


## Взаимодействие

### Правильный запрос
Запрос:

```
url -X POST 'http://localhost:8080/api/v1/calculate' 

--header 'Content-Type: application/json' 

--data '{
"expression": "2+2*2"
}'
```
Ответ:
```
{"id": "de9b328c-52a7-4454-b41f-9d7bef6ff24e"}
```
Код: `[201]`

### Неправильный метод
Запрос:
```
curl -X GET 'http://localhost:8080/api/v1/calculate' 

--header 'Content-Type: application/json' 

--data '{
"expression": "2+2"
}'
```
Ответ:
```
only POST method allowed
```
Код: `[405]`

### Деление на ноль
Запрос:
```
curl -X POST 'http://localhost:8080/api/v1/calculate' 

--header 'Content-Type: application/json' 

--data '{
"expression": "2/0"
}'
```
Ответ:
```
expression is not valid. division by zero
```
Код: `[422]`

### Неправильный ID
Запрос:
```
curl 'http://localhost:8080/api/v1/expressions/12345'
```
Ответ:
```
expression not found
```
Код: `[404]`
